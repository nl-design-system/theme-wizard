---
import './styles.css';
import '@nl-design-system-community/ma-design-tokens/dist/theme.css';
import tokens from '@nl-design-system-community/ma-design-tokens/dist/tokens.json';
import CollageLayout from '../../layouts/CollageLayout.astro';

export const detail = {
  name: 'Color Swatch',
  module: 'Voorbeeld van een kleurswatch',
  value: 'color-swatch',
};

function collectColorTokensFromScale(colorNodes: Record<string, any>): string[] {
  const grouped: string[] = [];
  Object.entries(colorNodes).forEach(([_, node]) => {
    // {
    //   $type: 'color',
    //   $value: '#ffffff',
    //   path: ['basis', 'color', 'default', 'bg-document'],
    //   ...
    // }
    Object.entries(node).filter(
      // [...{ path: ['basis', 'color', 'selected-inverse', 'bg-document']}] -> 'basis.color.selected-inverse.bg-document'
      ([key, colorValue]) => key === 'path' && Array.isArray(colorValue) && grouped.push(colorValue?.join('.'))
    );
  });
  return grouped;
}

function groupColorsByScale(): Record<string, string[]> {
  const group: Record<string, string[]> = {};
  const { color: colorTokens } = tokens.basis;
  for (const [scaleName, colorNodes] of Object.entries(colorTokens)) {
    // scaleName: the current scale identifier (e.g. 'default')
    // colorNodes: nested object containing all color nodes for this scale ['bg-document', 'bg-subtle', etc.]
    const entries = collectColorTokensFromScale(colorNodes);
    group[scaleName] = entries;
  }
  return group;
}
---

<style>
  .template-color-swatch-grid,
  .template-color-swatch-grid__row {
    display: flex;
    flex-direction: column;
  }

  .template-color-swatch-grid__label {
    margin: 0;
    text-transform: capitalize;
  }

  .template-color-swatch-grid__swatches {
    display: flex;
  }

  .template-color-swatch-grid__swatches > template-color-swatch {
    /* 14 columns for 14 color swatches */
    flex: 0 0 calc(100% / 14);
  }
</style>

<CollageLayout>
  <div class="template-color-swatch-grid">
    {
      Object.entries(groupColorsByScale()).map(([scale, references]) => {
        const rowLabel = scale.replaceAll('-', ' ');

        return (
          <section class="template-color-swatch-grid__row">
            <h3 class="template-color-swatch-grid__label">{rowLabel}</h3>
            <div class="template-color-swatch-grid__swatches">
              {references.map((reference) => (
                <template-color-swatch reference={reference} />
              ))}
            </div>
          </section>
        );
      })
    }
  </div>
</CollageLayout>
