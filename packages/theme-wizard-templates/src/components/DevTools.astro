---
// Check if we're in standalone mode (defined in astro.config.mjs)
const isStandalone = typeof __STANDALONE_PACKAGE__ !== 'undefined' && __STANDALONE_PACKAGE__ === true;
---

{isStandalone && (
  <div class="dev-tools">
    <a href="/">Back to home</a>
    <utrecht-button id="clear-localstorage" type="button">Clear localStorage</utrecht-button>
    <details class="dev-tools__details" hidden>
      <summary>cookies</summary>
      <pre id="localstorage-content" class="dev-tools__content"></pre>
    </details>
  </div>
)}

<style>
  .dev-tools {
    align-items: center;
    background-color: var(--utrecht-alert-warning-background-color);
    border: 1px solid var(--utrecht-alert-warning-border-color);
    border-radius: var(--utrecht-alert-border-radius);
    display: flex;
    gap: var(--clippy-space-column-md, var(--basis-space-column-md));
    left: 50%;
    margin: var(--basis-space-block-md);
    padding: var(--basis-space-block-md) var(--basis-space-inline-lg);
    position: fixed;
    top: 0;
    transform: translateX(-50%);
    z-index: 9999;
  }

  .dev-tools a,
  .dev-tools button {
    font-family: var(--basis-text-font-family-default);
    font-size: var(--basis-text-font-size-sm);
    line-height: var(--basis-text-line-height-sm);
    padding: var(--basis-space-inline-sm) var(--basis-space-inline-md);
  }

  .dev-tools button {
    background-color: var(--utrecht-button-secondary-action-background-color);
    border: 1px solid var(--utrecht-button-secondary-action-border-color);
    border-radius: var(--utrecht-button-border-radius);
    color: var(--utrecht-button-secondary-action-color);
    cursor: pointer;
    font-weight: var(--basis-text-font-weight-regular);
  }

  .dev-tools__details {
    font-size: var(--basis-text-font-size-sm);
  }

  .dev-tools__details[hidden] {
    display: none;
  }

  .dev-tools__details summary {
    cursor: pointer;
    font-weight: var(--basis-text-font-weight-medium);
    padding: var(--basis-space-inline-sm) 0;
  }

  .dev-tools__content {
    background-color: var(--utrecht-document-background-color, #fff);
    border: 1px solid var(--utrecht-color-grey-40, #ccc);
    border-radius: var(--utrecht-alert-border-radius);
    font-size: var(--basis-text-font-size-xs);
    margin-top: var(--basis-space-block-sm);
    max-height: 200px;
    overflow-wrap: break-word;
    overflow-y: auto;
    padding: var(--basis-space-block-sm) var(--basis-space-inline-sm);
    white-space: pre-wrap;
  }
</style>

{isStandalone && (
  <script>
    const STORAGE_KEY = 'cookie-consent-preferences';
    
    // Function to read and display localStorage content
    function updateLocalStorageDisplay() {
      const detailsElement = document.querySelector('.dev-tools__details');
      const contentElement = document.getElementById('localstorage-content');
      
      if (!detailsElement || !contentElement) return;

      try {
        const storedData = localStorage.getItem(STORAGE_KEY);
        if (storedData) {
          // Show details if there's data
          detailsElement.removeAttribute('hidden');
          
          // Try to parse and pretty-print JSON
          try {
            const parsed = JSON.parse(storedData);
            contentElement.textContent = JSON.stringify(parsed, null, 2);
          } catch {
            // If not valid JSON, just show the raw value
            contentElement.textContent = storedData;
          }
        } else {
          // Hide details if there's no data
          detailsElement.setAttribute('hidden', '');
        }
        } catch (error) {
          const errorMessage = error instanceof Error ? error.message : String(error);
          contentElement.textContent = `Fout bij lezen van localStorage: ${errorMessage}`;
        }
    }

    // Update display on page load
    updateLocalStorageDisplay();

    // Update display when details is opened
    const detailsElement = document.querySelector('.dev-tools__details') as HTMLDetailsElement | null;
    if (detailsElement) {
      detailsElement.addEventListener('toggle', () => {
        if (detailsElement?.open) {
          updateLocalStorageDisplay();
        }
      });
    }

    // Clear localStorage button
    const clearButton = document.getElementById('clear-localstorage');
    if (clearButton) {
      clearButton.addEventListener('click', () => {
        try {
          localStorage.removeItem(STORAGE_KEY);
          window.location.reload();
        } catch (error) {
          console.error('Fout bij verwijderen van localStorage:', error);
        }
      });
    }
  </script>
)}
