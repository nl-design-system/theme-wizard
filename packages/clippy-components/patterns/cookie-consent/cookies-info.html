<clippy-cookie-consent-info>
  <style>
    .clippy-cookie-consent-info__main > h1 {
      margin-block-end: var(--basis-space-block-lg);
    }

    .clippy-cookie-consent-info__intro {
      margin-block-end: var(--basis-space-block-xl);
    }

    .clippy-cookie-consent-info__intro > p {
      margin-block-end: 0;
    }

    .clippy-cookie-consent-info__section {
      margin-block-end: var(--basis-space-block-xl);
    }

    .clippy-cookie-consent-info__section > h2 {
      margin-block-end: var(--basis-space-block-lg);
    }

    .clippy-cookie-consent-info__noscript {
      margin-block-end: var(--basis-space-block-lg);
    }

    .clippy-cookie-consent-info__intro-text {
      margin-block-end: var(--basis-space-block-xl);
    }

    .clippy-cookie-consent-info__intro-text > p {
      margin-block-end: 0;
    }

    .clippy-cookie-consent-info__form .utrecht-form-fieldset {
      margin-block-end: var(--basis-space-block-xl);
    }

    .clippy-cookie-consent-info__form .utrecht-form-fieldset__legend > h3 {
      margin-block-end: var(--basis-space-block-md);
    }

    .clippy-cookie-consent-info__form .utrecht-form-fieldset__legend > p:first-of-type {
      margin-block-end: var(--basis-space-block-lg);
    }

    .clippy-cookie-consent-info__form .utrecht-form-field__label {
      margin-block-end: var(--basis-space-block-md);
    }

    .clippy-cookie-consent-info__form .utrecht-form-field__label:last-of-type {
      margin-block-end: var(--basis-space-block-xl);
    }

    .clippy-cookie-consent-info__button-group {
      margin-block-start: var(--basis-space-block-xl);
    }

    .clippy-cookie-consent-info__section--about > h2 {
      margin-block-end: var(--basis-space-block-lg);
    }

    .clippy-cookie-consent-info__section--about > p {
      margin-block-end: var(--basis-space-block-md);
    }

    .clippy-cookie-consent-info__section--about > p:last-of-type {
      margin-block-end: 0;
    }
  </style>

  <main id="main" class="clippy-cookie-consent-info__main">
    <h1 class="utrecht-heading-1">Cookies op deze voorbeeldwebsite</h1>

    <div class="clippy-cookie-consent-info__intro">
      <p class="utrecht-paragraph utrecht-paragraph--lead">
        We gebruiken essentiële cookies om deze omgeving goed te laten werken. We willen ook optionele cookies plaatsen
        om beter te begrijpen hoe je deze omgeving gebruikt en om onze diensten te verbeteren.
      </p>
    </div>

    <section aria-labelledby="cookie-settings-heading" class="clippy-cookie-consent-info__section">
      <h2 id="cookie-settings-heading" class="utrecht-heading-2">Cookie instellingen</h2>

      <noscript>
        <div class="utrecht-alert utrecht-alert--warning clippy-cookie-consent-info__noscript" role="alert">
          <p class="utrecht-paragraph">
            Om je cookie-instellingen te kunnen beheren, moet JavaScript ingeschakeld zijn in je browser. Schakel
            JavaScript in en ververs de pagina om je cookie-voorkeuren aan te passen.
          </p>
        </div>
      </noscript>

      <div class="clippy-cookie-consent-info__intro-text">
        <p class="utrecht-paragraph">
          Je kunt zelf kiezen welke soorten optionele cookies je toestaat. We gebruiken een cookie om je instellingen op
          te slaan. Dat betekent dat je instellingen gelden wanneer je deze omgeving gebruikt op hetzelfde apparaat en
          in dezelfde browser.
        </p>
      </div>

      <form hidden class="clippy-cookie-consent-info__form">
        <div class="utrecht-form-fieldset">
          <fieldset class="utrecht-form-fieldset__fieldset utrecht-form-fieldset--html-fieldset">
            <legend class="utrecht-form-fieldset__legend utrecht-form-fieldset__legend--html-legend">
              <h3 class="utrecht-heading-3">Cookies die het gebruik van de omgeving meten</h3>
            </legend>

            <p class="utrecht-paragraph">
              Deze cookies helpen ons te begrijpen hoe mensen deze omgeving gebruiken, zodat we deze kunnen verbeteren.
              Zo meten we bijvoorbeeld welke pagina's worden bezocht en hoelang bezoekers op een pagina blijven.
            </p>

            <div class="utrecht-form-field__label utrecht-form-field__label--radio">
              <label class="utrecht-form-label utrecht-form-label--radio">
                <input
                  type="radio"
                  name="analytics"
                  class="utrecht-radio-button utrecht-radio-button--html-input utrecht-radio-button--custom utrecht-form-field__input"
                  value="on"
                />
                Cookies gebruiken die het gebruik van de omgeving meten
              </label>
            </div>

            <div class="utrecht-form-field__label utrecht-form-field__label--radio">
              <label class="utrecht-form-label utrecht-form-label--radio">
                <input
                  type="radio"
                  name="analytics"
                  class="utrecht-radio-button utrecht-radio-button--html-input utrecht-radio-button--custom utrecht-form-field__input"
                  value="off"
                  checked
                />
                Geen cookies gebruiken die het gebruik van de omgeving meten
              </label>
            </div>
          </fieldset>
        </div>

        <div class="utrecht-form-fieldset">
          <fieldset class="utrecht-form-fieldset__fieldset utrecht-form-fieldset--html-fieldset">
            <legend class="utrecht-form-fieldset__legend utrecht-form-fieldset__legend--html-legend">
              <h3 class="utrecht-heading-3">Cookies die je instellingen onthouden</h3>
            </legend>

            <p class="utrecht-paragraph">
              Deze cookies onthouden je voorkeuren en de keuzes die je maakt, zodat we je ervaring kunnen
              personaliseren.
            </p>

            <div class="utrecht-form-field__label utrecht-form-field__label--radio">
              <label class="utrecht-form-label utrecht-form-label--radio">
                <input
                  type="radio"
                  name="preferences"
                  class="utrecht-radio-button utrecht-radio-button--html-input utrecht-radio-button--custom utrecht-form-field__input"
                  value="on"
                />
                Cookies gebruiken die mijn instellingen onthouden
              </label>
            </div>

            <div class="utrecht-form-field__label utrecht-form-field__label--radio">
              <label class="utrecht-form-label utrecht-form-label--radio">
                <input
                  type="radio"
                  name="preferences"
                  class="utrecht-radio-button utrecht-radio-button--html-input utrecht-radio-button--custom utrecht-form-field__input"
                  value="off"
                  checked
                />
                Geen cookies gebruiken die mijn instellingen onthouden
              </label>
            </div>
          </fieldset>
        </div>

        <div class="utrecht-form-fieldset">
          <fieldset class="utrecht-form-fieldset__fieldset utrecht-form-fieldset--html-fieldset">
            <legend class="utrecht-form-fieldset__legend utrecht-form-fieldset__legend--html-legend">
              <h3 class="utrecht-heading-3">Strikt noodzakelijke cookies</h3>
            </legend>

            <p class="utrecht-paragraph">
              Deze essentiële cookies zijn nodig om deze omgeving te laten werken. Ze onthouden bijvoorbeeld je
              voortgang in een meerstapsformulier.
            </p>

            <p class="utrecht-paragraph">Omdat ze essentieel zijn, staan deze cookies altijd aan.</p>
          </fieldset>
        </div>

        <div class="utrecht-button-group clippy-cookie-consent-info__button-group">
          <button type="submit" class="utrecht-button utrecht-button--primary-action">Wijzigingen opslaan</button>
        </div>
      </form>
    </section>

    <section
      aria-labelledby="more-about-cookies-heading"
      class="clippy-cookie-consent-info__section clippy-cookie-consent-info__section--about"
    >
      <h2 id="more-about-cookies-heading" class="utrecht-heading-2">Meer over cookies</h2>

      <p class="utrecht-paragraph">
        Cookies zijn kleine bestanden die op je computer, telefoon of tablet worden opgeslagen als je een website
        bezoekt. Ze helpen de website om informatie over je bezoek te onthouden.
      </p>

      <p class="utrecht-paragraph">
        Meer informatie over je rechten en heldere cookiebanners vind je in de uitleg van de Autoriteit
        Persoonsgegevens.
      </p>

      <p class="utrecht-paragraph">
        <a
          href="https://www.autoriteitpersoonsgegevens.nl/themas/internet-slimme-apparaten/cookies/heldere-cookiebanners"
          rel="noreferrer"
          class="utrecht-link utrecht-link--html-a"
        >
          Lees meer over heldere cookiebanners (Autoriteit Persoonsgegevens)
        </a>
      </p>
    </section>
  </main>
</clippy-cookie-consent-info>

<script type="module">
  const STORAGE_KEY = 'cookie-consent-preferences';

  class ClippyCookieConsentInfo extends HTMLElement {
    connectedCallback() {
      // Only show the form if JavaScript is enabled
      const form = this.querySelector('form');
      if (!form) return;

      // Remove hidden attribute to make the form visible
      form.removeAttribute('hidden');

      // Load saved preferences from localStorage and set radio buttons accordingly
      // This works with preferences saved from the cookie banner or from a previous visit to this page
      try {
        const saved = globalThis.localStorage?.getItem(STORAGE_KEY);
        if (saved) {
          const { preferences = [] } = JSON.parse(saved);
          // Restore radio button states based on saved preferences
          const analyticsInputs = form.querySelectorAll('input[name="analytics"]');
          const preferencesInputs = form.querySelectorAll('input[name="preferences"]');

          // First, uncheck all radio buttons to avoid conflicts
          analyticsInputs.forEach((input) => {
            input.checked = false;
          });
          preferencesInputs.forEach((input) => {
            input.checked = false;
          });

          // Then set the correct values based on saved preferences
          if (preferences.includes('analytics')) {
            analyticsInputs.forEach((input) => {
              if (input.value === 'on') input.checked = true;
            });
          } else {
            analyticsInputs.forEach((input) => {
              if (input.value === 'off') input.checked = true;
            });
          }

          if (preferences.includes('preferences')) {
            preferencesInputs.forEach((input) => {
              if (input.value === 'on') input.checked = true;
            });
          } else {
            preferencesInputs.forEach((input) => {
              if (input.value === 'off') input.checked = true;
            });
          }
        }
        // If no saved preferences, the HTML defaults (checked="off") will remain
      } catch {
        // localStorage not available or invalid data: continue without restoring state
        // HTML defaults (checked="off") will remain
      }

      const saveButton = form.querySelector('button[type="submit"]');
      const cancelButton = form.querySelector('button[type="button"]');

      const savePreferences = () => {
        const formData = new FormData(form);
        const preferences = [];

        if (formData.get('analytics') === 'on') {
          preferences.push('analytics');
        }
        if (formData.get('preferences') === 'on') {
          preferences.push('preferences');
        }

        try {
          // Store the choice locally so the banner is not shown again next time.
          // This is purely for the UI; reuse the same 'preferences' for your own consent management
          // if needed (for example by doing a fetch() to your backend here).
          globalThis.localStorage?.setItem(
            STORAGE_KEY,
            JSON.stringify({
              preferences,
              timestamp: new Date().toISOString(),
            }),
          );
        } catch {
          // localStorage not available or full: continue without crashing
        }

        // Show success message or redirect
        // You can customize this behavior based on your needs
      };

      if (saveButton) {
        saveButton.addEventListener('click', (event) => {
          event.preventDefault();
          savePreferences();
        });
      }

      if (cancelButton) {
        cancelButton.addEventListener('click', () => {
          // Reset form to saved state or navigate away
          globalThis.history?.back();
        });
      }
    }
  }

  if (typeof globalThis !== 'undefined' && 'customElements' in globalThis) {
    const tagName = 'clippy-cookie-consent-info';
    if (!customElements.get(tagName)) {
      customElements.define(tagName, ClippyCookieConsentInfo);
    }
  }
</script>
