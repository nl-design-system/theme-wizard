---
import { withRelatedProject } from '@vercel/related-projects';
import BaseLayout from '../layouts/BaseLayout.astro';
import { getStaticPaths } from './templates/[...template].astro';

export const prerender = false; // enable SSR

const scraperUrl = withRelatedProject({
  projectName: 'theme-wizard-server',
  // Fallback API host
  defaultHost: process.env.API_HOST || '',
});
const templates = getStaticPaths()
  .filter(t => t.params.template !== 'index')
  .map(({params}) => params.template)
const templatePath = Astro.url.searchParams.get('templatePath') || templates.at(0);
---

<style>
  .sidebar {
    display: grid;
    gap: 2rem;
  }
</style>

<BaseLayout title="Theme Wizard" scraperUrl={scraperUrl}>
  <theme-wizard-app>
    <wizard-layout>
      <div slot="sidebar" class="sidebar">
        <section>
          <h2>Analyzeer website</h2>
          <wizard-scraper scraperUrl={scraperUrl}></wizard-scraper>
        </section>
        <section>
          <h2>Maak design keuzes</h2>
          <wizard-tokens-form></wizard-tokens-form>
        </section>
      </div>

      <div slot="nav">
        <form action="">
          <label for="templatePath">Weergave</label>
          <select name="templatePath" id="templatePath">
            {templates.map((template) => (
              <option value={template}>{template}</option>
            ))}
          </select>
          <button>Go</button>
        </form>
      </div>

      <div slot="main">
        <wizard-preview url={`/${templatePath}`} scraperUrl={scraperUrl}></wizard-preview>
      </div>
     </wizard-layout>
  </theme-wizard-app>
</BaseLayout>
